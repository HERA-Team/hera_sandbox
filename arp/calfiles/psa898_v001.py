import aipy as a
import numpy as n
#import bm_prms as bm

prms = {
    'loc': ('-30:43:17.5', '21:25:41.9'), # KAT, SA (GPS)
    'cols' : range(8),
    'rows' : ['a','b','c','d'],
    'antpos': {
        3  :[-1.8703164651063193, -700.38179398735906, -2.486720328795109] ,
        2  : [4.8446646530159176, -700.39598247763035, 9.0712755708770896] ,
        1  : [11.591949094991772, -700.51959903136083, 20.550883906201953] ,
        0  : [18.303883632714129, -700.54155018781171, 32.147239675343215] ,

        7  :[-0.79691390069416523, -299.77026013347034, -1.1324501024272999] ,
        6  : [5.8589125156210056, -299.78452412641195, 10.430549257939724] ,
        5  : [12.570956582720362, -299.96597679156088, 22.013562464192603] ,
        4  : [19.315903718703861, -300.06359266903411, 33.543205414232105] ,

        11 :[-1.3878432448048694, -500.38082812384613, -1.7545471394250993] ,
        10 : [5.3138669086039991, -500.49730834340397, 9.946881319840271] ,
        9  : [12.000410085638356, -500.52004427391256, 21.494870295016263] ,
        8  : [18.700416704947475, -500.51760577469884, 32.967807350450215] ,

        15 :[-0.30041897106453369, -99.592047095062725, -0.4986783217372045] ,
        14 : [6.4059753694621326, -99.95224098313237, 10.967587452252552] ,
        13 : [13.103671269187693, -100.16568752920908, 22.495562579989407] ,
        12 : [19.71347252253916, -100.15113820962031, 33.991849122807949] ,

        19 : [-1.4502397412457093, -600.18812435901839, -1.9179935464574072] ,
        18 : [5.1717744224385322, -600.38441009883991, 9.5482722259790709] ,
        17 : [11.92743084773735, -600.50952069915058, 21.087922100514781] ,
        16 : [18.660932830697366, -600.37151947354073, 32.734312482817408] ,

        23 :[-0.65004684427314674, -199.90294892149257, -0.70882370043213849] ,
        22 : [6.085058720866952, -199.91607722453426, 10.832493993299661] ,
        21 : [12.764558079120691, -200.09371555153467, 22.343790916649397] ,
        20 : [19.490548357060103, -200.03876633995446, 33.933475405899749] ,

        27 :[-1.1241140538220571, -400.00575563876032, -1.5594121443679183] ,
        26 : [5.627745048786398, -400.21358435343956, 10.011926318192666] ,
        25 : [12.334663628936832, -400.32135868916214, 21.53990144903608] ,
        24 : [19.066037795876635, -400.28464748951757, 33.111239910043388] ,

        31 :[0.0, 0.0, 0.0] ,
        30 :[6.6895727415641932, 0.035200138018290757, 11.576341924808688] ,
        29 : [13.380230127377081, 0.14164134349682395, 23.136005645230252] ,
        28 : [20.113783156528598, 0.12912235844973025, 34.702340643989459] ,
    }
}

def number2battleship():
    """
    Return a dictionary mapping antenna number to battleship notation.
    """
    bs,i = {},0
    for row in prms['rows']:
        for col in prms['cols']:
            bs[i] = row+str(col)
            i += 1
    return bs

def battleship2number():
    """
    Inverse of number2battleship
    """
    bs = {}
    n2bs = number2battleship()
    for num in n2bs: bs[n2bs[num]] = num
    return bs

def get_aa(freqs):
    location = prms['loc']
    antennas = []
    nants =  len(prms['antpos'])
    #for pi in ('x','y'):
    for i in range(nants):
        pos = prms['antpos'][i]
        #beam = bm.prms['beam'](freqs,nside=32,lmax=20,mmax=20,deg=7)
        beam = a.fit.Beam(freqs)
        antennas.append(
            a.fit.Antenna(pos[0],pos[1],pos[2],beam,lat=prms['loc'][0])
            )
    aa = a.pol.AntennaArray(prms['loc'],antennas)
    return aa
