#!/usr/bin/env python

"""

NAME: 
      pspec_sim_test.py 
PURPOSE:
      -Tests correlation between maps generated by pspec_sim_v2.py
EXAMPLE CALL:
      ./pspec_sim_test.py --pspec pspec50lmax200 --nchan 50 --sdf 0.001
AUTHOR:
      Carina Cheng

"""

import aipy
import numpy
import pylab
import pyfits
import matplotlib.pyplot as plt
import optparse
import os, sys
import healpy
import scipy

o = optparse.OptionParser()
o.set_usage('fitstopng.py [options]')
o.set_description(__doc__)
o.add_option('--pspec', dest='pspec', default='pspec50lmax200',
             help='Directory where pspec images are contained.')
o.add_option('--nchan', dest='nchan', default=3, type='int',
             help='Number of channels in simulated data. Default is 3.')
o.add_option('--sfreq', dest='sfreq', default=0.1, type='float',
             help='Start frequency (GHz). Default is 0.1.')
o.add_option('--sdf', dest='sdf', default=0.1/20, type='float',
             help='Channel spacing (GHz).  Default is 0.1/20.')
opts, args = o.parse_args(sys.argv[1:])

path = '/Users/carinacheng/capo/ctc/images/pspecs/' + opts.pspec

#plot one pixel value vs. frequency of maps

fluxes = []
freqs = numpy.linspace(opts.sfreq,opts.sfreq+opts.sdf*opts.nchan,num=opts.nchan, endpoint=False) #array of frequencies

for root, dirs, filenames in os.walk(path):
    for f in filenames:
        if f[9:] == '.fits':
            img = aipy.map.Map(fromfits = path + '/' + f)
            flux_px = img.map.map[0:10] #first 10 pixel values
            fluxes.append(flux_px)

plt.plot(freqs, fluxes, 'k-')
plt.xlabel('frequency [GHz]')
plt.ylabel('pixel value')
plt.show()
